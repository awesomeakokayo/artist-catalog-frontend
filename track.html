<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Track Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="assets/css/track.css">
</head>
<body>
  <div class="track-container" id="track-container">
    <img class="track-cover" id="track-cover" alt="">
    <h2 class="track-title" id="track-title"></h2>
    <div class="platforms" id="platforms"></div>
  </div>

  <script>
    const API_BASE = "https://artist-website-huey.onrender.com";
    const urlParams = new URLSearchParams(window.location.search);
    const trackId = urlParams.get("id");

    async function loadTrack(id) {
      const res = await fetch(`${API_BASE}/catalogs/${id}`);
      if (!res.ok) {
        document.getElementById('track-container').textContent = "Track not found.";
        return;
      }
      const track = await res.json();
      document.getElementById("track-title").textContent = track.title || "Untitled";
      document.getElementById("track-cover").src = API_BASE + track.cover_image;
      // background
      document.body.style.backgroundImage = `url('${API_BASE + track.cover_image}')`;
      document.body.style.backgroundSize = "cover";
      document.body.style.backgroundPosition = "center";
      document.body.style.backgroundRepeat = "no-repeat";
      document.body.style.backgroundAttachment = "fixed";

      const platformsDiv = document.getElementById("platforms");
      platformsDiv.innerHTML = "";
      for (const [platform, info] of Object.entries(track.links)) {
        if (!info.url) continue; // skip platforms that have no link
        const row = document.createElement("div");
        row.className = "platform-row";

        const img = document.createElement("img");
        img.src = API_BASE + info.logo; 
        img.className = "platform-logo";

        const btn = document.createElement("a");
        btn.href = info.url;
        btn.target = "_blank";
        btn.className = "play-btn";
        btn.textContent = "Play";

        row.appendChild(img);
        row.appendChild(btn);
        platformsDiv.appendChild(row);
      }
    }

    if (trackId) loadTrack(trackId);
    else document.getElementById('track-container').textContent = "Track id missing";
  </script>
</body>
</html>
